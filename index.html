<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üíå A Little Valentine For You</title>

  <style>
    :root{
      --bg:#0b0b12;
      --card:#151525;
      --text:#f5f5ff;
      --muted:#b9b9d6;
      --accent:#ff4d8d;
      --accent2:#7c5cff;
      color-scheme: dark;
    }
    html, body { color-scheme: dark; }
    *{ box-sizing:border-box; }

    body{
      margin:0;
      min-height:100vh;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color: var(--text);
      background:
        radial-gradient(900px 500px at 20% 10%, rgba(255,77,141,.25), transparent 60%),
        radial-gradient(900px 500px at 80% 20%, rgba(124,92,255,.25), transparent 60%),
        linear-gradient(180deg, #07070d, #0b0b12);
      display:grid;
      place-items:center;
      padding:24px;
      overflow-x:hidden;
    }

    .wrap{ width:min(860px, 100%); }

    .top{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:16px;
      margin-bottom:16px;
    }
    .badge{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:10px 12px;
      border-radius:999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      color: var(--muted);
      font-size:13px;
      backdrop-filter: blur(6px);
    }

    .card{
      background: rgba(21,21,37,.85);
      border:1px solid rgba(255,255,255,.12);
      border-radius:18px;
      box-shadow: 0 12px 40px rgba(0,0,0,.35);
      overflow:hidden;
    }

    .hero{
      padding:26px 22px 18px;
      background:
        radial-gradient(600px 240px at 20% 20%, rgba(255,77,141,.30), transparent 60%),
        radial-gradient(600px 240px at 80% 10%, rgba(124,92,255,.25), transparent 60%);
      border-bottom:1px solid rgba(255,255,255,.10);
    }

    h1{ margin:0 0 8px; font-size: clamp(22px, 3.2vw, 34px); }
    p{ margin:0; color: var(--muted); line-height:1.5; }

    .content{ padding:18px 22px 22px; }

    label{ display:block; font-size:13px; color: var(--muted); margin: 10px 0 6px; }

    input[type="text"], textarea, select{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      outline:none;
      -webkit-appearance: none;
      appearance: none;
    }
    textarea{ min-height: 96px; resize: vertical; }

    /* Safari dropdown readability */
    select{
      background-color: rgba(255,255,255,.08) !important;
      color: #f5f5ff !important;
    }
    option, optgroup{
      background-color:#151525 !important;
      color:#f5f5ff !important;
    }
    input:focus, textarea:focus, select:focus{
      outline: 2px solid rgba(255,77,141,.55);
      outline-offset: 2px;
    }

    .q{
      padding:14px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      margin-top:14px;
    }
    .qtitle{ font-weight:650; margin:0 0 4px; }
    .qsub{ margin:0 0 10px; font-size:13px; color: var(--muted); }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:16px;
    }
    button{
      border:0;
      padding:12px 14px;
      border-radius:12px;
      color:white;
      cursor:pointer;
      font-weight:650;
    }
    .primary{ background: linear-gradient(90deg, var(--accent), #ff7aa9); }
    .secondary{ background: rgba(255,255,255,.10); }
    .ghost{ background: transparent; border: 1px solid rgba(255,255,255,.18); }
    button:disabled{ opacity:.55; cursor:not-allowed; }

    .progress{
      height:10px;
      background: rgba(255,255,255,.08);
      border-radius:999px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
    }
    .bar{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      transition: width .35s ease;
    }
    .small{ font-size:12px; color: var(--muted); margin-top:8px; }
    .hidden{ display:none; }

    /* Choice cards */
    .choices{ display:grid; gap:10px; margin-top:10px; }
    .choice{
      display:flex;
      align-items:center;
      gap:10px;
      padding:12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      user-select:none;
    }
    .choice:hover{ background: rgba(255,255,255,.09); }
    .choice input{
      width:18px;
      height:18px;
      accent-color: var(--accent);
      flex: 0 0 auto;
    }

    .final{
      padding: 18px 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(600px 240px at 20% 20%, rgba(255,77,141,.20), transparent 60%),
        radial-gradient(600px 240px at 80% 10%, rgba(124,92,255,.18), transparent 60%),
        rgba(255,255,255,.03);
      margin-top: 16px;
    }
    .loveTitle{
      margin: 4px 0 8px;
      font-size: clamp(20px, 3vw, 30px);
      font-weight: 800;
      letter-spacing: .2px;
    }
    .loveMsg{
      margin: 0 0 10px;
      color: rgba(255,255,255,.85);
      line-height: 1.55;
      font-size: 15px;
    }

    .copybox{
      margin-top:12px;
      padding:12px;
      border-radius:12px;
      background: rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.10);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono";
      font-size:12px;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .footer{
      margin-top:14px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      color: rgba(255,255,255,.45);
      font-size:12px;
    }

    /* restart fixed */
    .restartFixed{
      position: fixed;
      top: 14px;
      right: 14px;
      z-index: 20;
      display:flex;
      gap:10px;
      align-items:center;
    }

    /* Sparkle overlay */
    #sparkleLayer{
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 999;
      overflow: hidden;
    }
    .sparkle{
      position:absolute;
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: rgba(255,255,255,.9);
      box-shadow: 0 0 12px rgba(255,255,255,.9);
      opacity: 0;
      transform: translate3d(0,0,0);
      animation: sparkleFloat 1200ms ease-in-out forwards;
    }
    @keyframes sparkleFloat{
      0%   { opacity: 0; transform: translate3d(0,0,0) scale(.6); }
      20%  { opacity: 1; }
      60%  { opacity: .9; }
      100% { opacity: 0; transform: translate3d(var(--dx), var(--dy), 0) scale(1.4); }
    }
    .sparkleFadeOut{ animation: layerFade 700ms ease forwards; }
    @keyframes layerFade{ from { opacity: 1; } to { opacity: 0; } }

    /* Sent overlay */
    .sentOverlay{
      position: fixed;
      inset: 0;
      z-index: 2000;
      display: grid;
      place-items: center;
      background: rgba(0,0,0,.45);
      backdrop-filter: blur(6px);
      opacity: 0;
      pointer-events: none;
      transition: opacity .35s ease;
    }
    .sentOverlay.show{
      opacity: 1;
      pointer-events: all;
    }
    .sentCard{
      width: min(520px, calc(100% - 32px));
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(600px 240px at 20% 20%, rgba(255,77,141,.25), transparent 60%),
        radial-gradient(600px 240px at 80% 10%, rgba(124,92,255,.20), transparent 60%),
        rgba(21,21,37,.92);
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      padding: 18px 16px;
      text-align: center;
      transform: translateY(10px) scale(.98);
      animation: popIn .55s ease forwards;
    }
    @keyframes popIn{
      to { transform: translateY(0) scale(1); }
    }
    .sentBig{
      font-size: 22px;
      font-weight: 850;
      margin: 2px 0 8px;
    }
    .sentSmall{
      color: rgba(255,255,255,.78);
      margin: 0;
      line-height: 1.5;
    }
    .hearts{
      margin-top: 12px;
      font-size: 20px;
      opacity: .95;
      animation: floatHearts 1.2s ease-in-out infinite;
    }
    @keyframes floatHearts{
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }
  </style>
</head>

<body>
  <div id="sparkleLayer" aria-hidden="true"></div>

  <div class="sentOverlay" id="sentOverlay" aria-hidden="true">
    <div class="sentCard">
      <div class="sentBig">Your answer was sent ‚ù§Ô∏è</div>
      <p class="sentSmall">Saved successfully. You can restart anytime if you want to do it again ‚ú®</p>
      <div class="hearts">üíó üíû üíó üíû üíó</div>
    </div>
  </div>

  <div class="restartFixed">
    <button class="ghost" id="restartGlobalBtn">Restart ‚Üª</button>
  </div>

  <div class="wrap">
    <div class="top">
      <div class="badge">üíó Valentine Mini-Site</div>
      <div class="badge" id="attemptBadge">Attempt: #1</div>
    </div>

    <div class="card">
      <div class="hero">
        <h1 id="title">Hi my love üíå</h1>
        <p id="subtitle">Answer a few questions and unlock a surprise at the end.</p>
        <div style="margin-top:14px" class="progress">
          <div class="bar" id="bar"></div>
        </div>
        <div class="small" id="stepText">Step 1 of 6</div>
      </div>

      <div class="content">
        <!-- Step 1 -->
        <section class="step" data-step="1">
          <label>Your name</label>
          <input id="herName" type="text" placeholder="Type your name" />

          <label>Today‚Äôs vibe</label>
          <input id="vibe" type="text" placeholder="e.g., happy / cozy / missing you" />

          <div class="q">
            <div class="qtitle">Quick promise ü§ù</div>
            <p class="qsub">Tap to confirm.</p>
            <label style="margin-top:8px">
              <input id="promise" type="checkbox" style="accent-color: var(--accent);" />
              I promise üòå
            </label>
          </div>
        </section>

        <!-- Step 2 -->
        <section class="step hidden" data-step="2">
          <div class="q">
            <div class="qtitle">1) Pick our cutest memory</div>
            <p class="qsub">Choose one</p>
            <div class="choices">
              <label class="choice"><input type="radio" name="memory" value="Our first proper date"> Our first proper date</label>
              <label class="choice"><input type="radio" name="memory" value="That time we laughed non-stop"> That time we laughed non-stop</label>
              <label class="choice"><input type="radio" name="memory" value="A simple moment that felt perfect"> A simple moment that felt perfect</label>
              <label class="choice"><input type="radio" name="memory" value="A surprise / unexpected moment"> A surprise / unexpected moment</label>
            </div>
          </div>
        </section>

        <!-- Step 3 -->
        <section class="step hidden" data-step="3">
          <div class="q">
            <div class="qtitle">2) First word when you think of me?</div>
            <p class="qsub">Choose one</p>
            <div class="choices">
              <label class="choice"><input type="radio" name="word" value="Home"> Home</label>
              <label class="choice"><input type="radio" name="word" value="Peace"> Peace</label>
              <label class="choice"><input type="radio" name="word" value="Comfort"> Comfort</label>
              <label class="choice"><input type="radio" name="word" value="Funny"> Funny</label>
              <label class="choice"><input type="radio" name="word" value="Love"> Love</label>
            </div>
          </div>
        </section>

        <!-- Step 4 -->
        <section class="step hidden" data-step="4">
          <div class="q">
            <div class="qtitle">3) Choose our next date idea</div>
            <p class="qsub">Pick one</p>
            <div class="choices">
              <label class="choice"><input type="radio" name="dateIdea" value="Food + long talk"> Food + long talk</label>
              <label class="choice"><input type="radio" name="dateIdea" value="Movie night + snacks"> Movie night + snacks</label>
              <label class="choice"><input type="radio" name="dateIdea" value="Picnic / sunset"> Picnic / sunset</label>
              <label class="choice"><input type="radio" name="dateIdea" value="Surprise date (you choose everything)"> Surprise date (you choose everything)</label>
            </div>
          </div>
        </section>

        <!-- Step 5 -->
        <section class="step hidden" data-step="5">
          <div class="q">
            <div class="qtitle">4) What you want more of from me</div>
            <p class="qsub">Choose at least one</p>
            <div class="choices">
              <label class="choice"><input type="checkbox" name="moreOf" value="More time together"> More time together</label>
              <label class="choice"><input type="checkbox" name="moreOf" value="More communication"> More communication</label>
              <label class="choice"><input type="checkbox" name="moreOf" value="More reassurance"> More reassurance</label>
              <label class="choice"><input type="checkbox" name="moreOf" value="More hugs / affection"> More hugs / affection</label>
              <label class="choice"><input type="checkbox" name="moreOf" value="More surprise dates"> More surprise dates</label>
            </div>
          </div>

          <div class="q">
            <div class="qtitle">Kiss level üò≥</div>
            <p class="qsub">Choose one</p>
            <div class="choices">
              <label class="choice"><input type="radio" name="kiss" value="1"> 1 ‚Äî shy</label>
              <label class="choice"><input type="radio" name="kiss" value="2"> 2 ‚Äî cute</label>
              <label class="choice"><input type="radio" name="kiss" value="3"> 3 ‚Äî dangerous</label>
              <label class="choice"><input type="radio" name="kiss" value="4"> 4 ‚Äî criminal</label>
            </div>
          </div>
        </section>

        <!-- Step 6 -->
        <section class="step hidden" data-step="6">
          <div class="final">
            <div class="loveTitle" id="loveTitle">Unlocked ‚ú®</div>
            <p class="loveMsg" id="loveMsg"></p>
            <div class="copybox" id="summary"></div>
            <div class="actions">
              <button class="primary" id="copyBtn">Copy summary</button>
              <button class="secondary" id="restartBtnFinal">Restart</button>
            </div>
          </div>
        </section>

        <div class="actions">
          <button class="secondary" id="backBtn">Back</button>
          <button class="primary" id="nextBtn">Next</button>
        </div>

        <div class="footer">
          <div>Safari-ready UI ‚úÖ</div>
          <div id="hint"></div>
        </div>
      </div>
    </div>
  </div>

  <iframe name="gform_iframe" style="display:none;"></iframe>

<script>
  /***************
   * GOOGLE FORM CONNECTION (NEW FORM you just created)
   ***************/
  const FORM_RESPONSE_URL =
    "https://docs.google.com/forms/d/e/1FAIpQLScjpglvS4uEXaaOytWltDe2B6LK8YeSEqW7WIQ0uGAELX7RYg/formResponse";

  const ENTRY = {
    attemptId:     "entry.227473240",
    attemptNumber: "entry.770562452",
    status:        "entry.501665858",
    startedAt:     "entry.1140751729",
    submittedAt:   "entry.806646288",

    herName:       "entry.117109998",
    vibe:          "entry.1184738343",
    promise:       "entry.1109897456",
    memory:        "entry.383480975",
    firstWord:     "entry.1849547503",
    dateIdea:      "entry.2129156152",
    moreOf:        "entry.1413831227",
    kiss:          "entry.342265240"
  };

  /***************
   * STATE
   ***************/
  const steps = Array.from(document.querySelectorAll(".step"));
  const bar = document.getElementById("bar");
  const stepText = document.getElementById("stepText");
  const title = document.getElementById("title");
  const subtitle = document.getElementById("subtitle");
  const hint = document.getElementById("hint");
  const attemptBadge = document.getElementById("attemptBadge");

  const backBtn = document.getElementById("backBtn");
  const nextBtn = document.getElementById("nextBtn");
  const restartGlobalBtn = document.getElementById("restartGlobalBtn");
  const restartBtnFinal = document.getElementById("restartBtnFinal");

  const herName = document.getElementById("herName");
  const vibe = document.getElementById("vibe");
  const promise = document.getElementById("promise");

  const loveTitle = document.getElementById("loveTitle");
  const loveMsg = document.getElementById("loveMsg");
  const summaryBox = document.getElementById("summary");
  const copyBtn = document.getElementById("copyBtn");
  const sentOverlay = document.getElementById("sentOverlay");

  const ATTEMPT_NUM_KEY = "val_attempt_num_v2";
  const STORAGE_KEY = "val_attempt_history_v2";

  let currentStep = 1;
  let attemptId = "";
  let attemptNumber = 1;
  let startedAtISO = "";
  let hasSubmittedThisAttempt = false;

  const $qsa = (sel) => Array.from(document.querySelectorAll(sel));

  function uuid() {
    return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, c => {
      const r = (Math.random() * 16) | 0;
      const v = c === "x" ? r : (r & 0x3) | 0x8;
      return v.toString(16);
    });
  }
  function nowISO() { return new Date().toISOString(); }

  function getRadioValue(name) {
    const r = document.querySelector(`input[name="${name}"]:checked`);
    return r ? r.value : "";
  }
  function getCheckboxValues(name) {
    return $qsa(`input[name="${name}"]:checked`).map(x => x.value);
  }

  function updateHeader() {
    const percent = ((currentStep - 1) / (steps.length - 1)) * 100;
    bar.style.width = `${percent}%`;
    stepText.textContent = `Step ${currentStep} of ${steps.length}`;

    const nm = (herName.value || "my love").trim();
    title.textContent = `Hi ${nm} üíå`;
    subtitle.textContent = `Answer a few questions and unlock a surprise at the end.`;

    const hints = {
      1: "Tick the promise box to continue üòâ",
      2: "Pick a memory ü•∫",
      3: "Pick one word üòå",
      4: "Choose our date idea üòè",
      5: "Pick at least one + kiss level üò≥",
      6: "Submitted ‚úÖ"
    };
    hint.textContent = hints[currentStep] || "";
    attemptBadge.textContent = `Attempt: #${attemptNumber}`;
  }

  function showStep(n) {
    steps.forEach(s => s.classList.add("hidden"));
    const target = steps.find(s => Number(s.dataset.step) === n);
    if (target) target.classList.remove("hidden");

    backBtn.disabled = (n === 1);
    nextBtn.textContent = (n === steps.length) ? "Done" : "Next";
    updateHeader();
    validate();
  }

  function validate() {
    let ok = true;
    if (currentStep === 1) ok = promise.checked;
    if (currentStep === 2) ok = getRadioValue("memory") !== "";
    if (currentStep === 3) ok = getRadioValue("word") !== "";
    if (currentStep === 4) ok = getRadioValue("dateIdea") !== "";
    if (currentStep === 5) ok = (getCheckboxValues("moreOf").length >= 1) && (getRadioValue("kiss") !== "");
    nextBtn.disabled = !ok;
    return ok;
  }

  function collectData() {
    return {
      attemptId,
      attemptNumber,
      startedAt: startedAtISO,
      herName: herName.value.trim(),
      vibe: vibe.value.trim(),
      promise: promise.checked ? "true" : "false",
      memory: getRadioValue("memory"),
      firstWord: getRadioValue("word"),
      dateIdea: getRadioValue("dateIdea"),
      moreOf: getCheckboxValues("moreOf"),
      kiss: getRadioValue("kiss")
    };
  }

  function buildSummary(status) {
    const d = collectData();
    return `Attempt #${d.attemptNumber} (${status})
Attempt ID: ${d.attemptId}
Started: ${d.startedAt}

Name: ${d.herName || "(blank)"}
Vibe: ${d.vibe || "(blank)"}
Promise: ${d.promise}

Memory: ${d.memory || "(blank)"}
First word: ${d.firstWord || "(blank)"}
Date idea: ${d.dateIdea || "(blank)"}
More of: ${d.moreOf.length ? d.moreOf.join(", ") : "(blank)"}
Kiss: ${d.kiss || "(blank)"}`;
  }

  function showSentOverlay() {
    sentOverlay.classList.add("show");
    setTimeout(() => sentOverlay.classList.remove("show"), 2200);
  }

  function submitAttempt(status) {
    if (hasSubmittedThisAttempt) return;
    hasSubmittedThisAttempt = true;

    const d = collectData();
    const submittedAtISO = nowISO();

    // store locally too
    const list = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
    list.push({ ...d, status, submittedAt: submittedAtISO });
    localStorage.setItem(STORAGE_KEY, JSON.stringify(list));

    // HTML POST (Google accepts always)
    const form = document.createElement("form");
    form.method = "POST";
    form.action = FORM_RESPONSE_URL;
    form.target = "gform_iframe";

    const add = (name, value) => {
      const input = document.createElement("input");
      input.type = "hidden";
      input.name = name;
      input.value = value ?? "";
      form.appendChild(input);
    };

    add(ENTRY.attemptId, d.attemptId);
    add(ENTRY.attemptNumber, String(d.attemptNumber));
    add(ENTRY.status, status);
    add(ENTRY.startedAt, d.startedAt);
    add(ENTRY.submittedAt, submittedAtISO);

    add(ENTRY.herName, d.herName);
    add(ENTRY.vibe, d.vibe);
    add(ENTRY.promise, d.promise);
    add(ENTRY.memory, d.memory);
    add(ENTRY.firstWord, d.firstWord);
    add(ENTRY.dateIdea, d.dateIdea);
    add(ENTRY.moreOf, (d.moreOf || []).join(", "));
    add(ENTRY.kiss, d.kiss);

    document.body.appendChild(form);
    form.submit();
    form.remove();

    showSentOverlay();
  }

  function startNewAttempt() {
    attemptNumber = Number(localStorage.getItem(ATTEMPT_NUM_KEY) || "0") + 1;
    localStorage.setItem(ATTEMPT_NUM_KEY, String(attemptNumber));

    attemptId = uuid();
    startedAtISO = nowISO();
    hasSubmittedThisAttempt = false;

    updateHeader();
  }

  function resetInputs() {
    herName.value = "";
    vibe.value = "";
    promise.checked = false;
    $qsa('input[type="radio"]').forEach(r => r.checked = false);
    $qsa('input[type="checkbox"]').forEach(c => c.checked = false);
  }

  function restartFlow() {
    submitAttempt("abandoned");
    startNewAttempt();
    resetInputs();
    currentStep = 1;
    showStep(currentStep);
  }

  function showFinalAndSubmit() {
    const nm = (herName.value || "my love").trim();
    const word = getRadioValue("word") || "everything";
    const date = getRadioValue("dateIdea") || "a date";

    loveTitle.textContent = "I choose you üíó";
    loveMsg.textContent =
      `${nm}, thank you for doing this ü•∫. You picked ‚Äú${word}‚Äù for me and I‚Äôm smiling like an idiot. ` +
      `Our next plan is: ${date}. Just remember ‚Äî you‚Äôre my favorite person. Always.`;

    summaryBox.textContent = buildSummary("completed");
    submitAttempt("completed");
  }

  function runSparkles(durationMs = 5000) {
    const layer = document.getElementById("sparkleLayer");
    const start = performance.now();
    let lastSpawn = 0;

    function spawnOne() {
      const s = document.createElement("div");
      s.className = "sparkle";
      const x = Math.random() * window.innerWidth;
      const y = Math.random() * window.innerHeight;
      const dx = (Math.random() * 2 - 1) * 120 + "px";
      const dy = (Math.random() * 2 - 1) * 120 + "px";
      s.style.left = x + "px";
      s.style.top = y + "px";
      s.style.setProperty("--dx", dx);
      s.style.setProperty("--dy", dy);
      const size = 4 + Math.random() * 4;
      s.style.width = size + "px";
      s.style.height = size + "px";
      layer.appendChild(s);
      setTimeout(() => s.remove(), 1400);
    }

    function tick(t) {
      if (t - start >= durationMs) {
        layer.classList.add("sparkleFadeOut");
        setTimeout(() => layer.remove(), 800);
        return;
      }
      if (t - lastSpawn >= 90) {
        lastSpawn = t;
        for (let i = 0; i < 3; i++) spawnOne();
      }
      requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);
  }

  document.addEventListener("input", validate);
  document.addEventListener("change", validate);

  backBtn.addEventListener("click", () => {
    if (currentStep > 1) {
      currentStep--;
      showStep(currentStep);
    }
  });

  nextBtn.addEventListener("click", () => {
    if (!validate()) return;

    if (currentStep < steps.length) {
      currentStep++;
      if (currentStep === steps.length) showFinalAndSubmit();
      showStep(currentStep);
    }
  });

  restartGlobalBtn.addEventListener("click", restartFlow);
  restartBtnFinal.addEventListener("click", restartFlow);

  copyBtn.addEventListener("click", async () => {
    try {
      await navigator.clipboard.writeText(summaryBox.textContent);
      copyBtn.textContent = "Copied ‚úÖ";
      setTimeout(() => copyBtn.textContent = "Copy summary", 1200);
    } catch {
      alert("Copy failed. You can select and copy manually.");
    }
  });

  window.addEventListener("pagehide", () => {
    if (!hasSubmittedThisAttempt) submitAttempt("abandoned");
  });

  // INIT
  startNewAttempt();
  showStep(currentStep);
  runSparkles(5000);
</script>
</body>
</html>
